<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PC HUB - Tienda</title>
    <!-- Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>
<body class="bg-gray-900 min-h-screen">
    <!-- Barra de navegación -->
    <nav class="bg-gray-800 text-white p-4">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-2xl font-bold">PC<span class="text-yellow-400">HUB</span></h1>
            <div class="flex items-center space-x-4">
                <a href="/admin" class="hover:text-yellow-400">
                    <i class="fas fa-cog"></i> Admin
                </a>
                <button id="cartBtn" class="hover:text-yellow-400">
                    <i class="fas fa-shopping-cart"></i>
                    <span id="cartCount" class="bg-yellow-400 text-black px-2 py-1 rounded-full text-xs">0</span>
                </button>
                <button id="logoutBtn" class="bg-red-600 px-4 py-2 rounded hover:bg-red-700">
                    <i class="fas fa-sign-out-alt"></i> Cerrar Sesión
                </button>
            </div>
        </div>
    </nav>

    <!-- Contenido principal con padding-top para compensar la navbar fija -->
    <main class="max-w-7xl mx-auto px-4 py-8 mt-16">
        <!-- Carrusel de productos destacados -->
        <div class="mb-8 relative overflow-hidden rounded-xl shadow-2xl h-[500px]">
            <div id="featuredCarousel" class="flex transition-transform duration-500 h-full">
                <!-- Las imágenes se cargarán dinámicamente -->
            </div>
            <!-- Botones de navegación -->
            <button id="prevSlide" class="absolute left-4 top-1/2 transform -translate-y-1/2 bg-black/50 text-white p-2 rounded-full hover:bg-black/70 transition-colors z-10">
                <i class="fas fa-chevron-left"></i>
            </button>
            <button id="nextSlide" class="absolute right-4 top-1/2 transform -translate-y-1/2 bg-black/50 text-white p-2 rounded-full hover:bg-black/70 transition-colors z-10">
                <i class="fas fa-chevron-right"></i>
            </button>
            <!-- Indicadores -->
            <div id="carouselIndicators" class="absolute bottom-4 left-1/2 transform -translate-x-1/2 flex space-x-2 z-10">
                <!-- Los indicadores se cargarán dinámicamente -->
            </div>
        </div>

        <!-- Filtros y búsqueda -->
        <div class="mb-8 flex flex-col md:flex-row justify-between items-center space-y-4 md:space-y-0">
            <div class="flex space-x-4">
                <select id="categoryFilter" class="bg-gray-700 text-white rounded-lg px-4 py-2">
                    <option value="">Todas las categorías</option>
                    <option value="cpu">Procesadores</option>
                    <option value="gpu">Tarjetas gráficas</option>
                    <option value="ram">Memoria RAM</option>
                    <option value="storage">Almacenamiento</option>
                    <option value="motherboard">Placas Madre</option>
                    <option value="psu">Fuentes de Poder</option>
                    <option value="cooling">Refrigeración</option>
                    <option value="case">Gabinetes</option>
                </select>
                <select id="sortFilter" class="bg-gray-700 text-white rounded-lg px-4 py-2">
                    <option value="">Ordenar por</option>
                    <option value="price_asc">Precio: Menor a Mayor</option>
                    <option value="price_desc">Precio: Mayor a Menor</option>
                    <option value="name_asc">Nombre: A-Z</option>
                    <option value="name_desc">Nombre: Z-A</option>
                </select>
            </div>
            <div class="relative">
                <input type="text" id="searchInput" placeholder="Buscar productos..." 
                    class="bg-gray-700 text-white rounded-lg pl-10 pr-4 py-2 w-64">
                <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
            </div>
        </div>

        <!-- Grid de productos -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6" id="productsGrid">
            <!-- Los productos se cargarán dinámicamente aquí -->
        </div>
    </main>

    <!-- Spinner de carga con texto -->
    <div id="spinner" class="fixed inset-0 bg-black bg-opacity-50 flex flex-col items-center justify-center z-50 hidden">
        <div class="animate-spin rounded-full h-24 w-24 border-t-4 border-b-4 border-yellow-400 mb-6"></div>
        <p class="text-yellow-400 text-xl font-semibold animate-pulse">Cargando productos...</p>
    </div>

    <!-- Pie de página -->
    <footer class="bg-gray-800 text-white mt-16">
        <div class="max-w-7xl mx-auto px-4 py-12">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
                <!-- Quiénes Somos -->
                <div class="space-y-4">
                    <h3 class="text-xl font-bold text-yellow-400">PC<span class="text-white">HUB</span></h3>
                    <p class="text-gray-300">
                        Somos tu tienda especializada en componentes de PC de alta gama. Ofrecemos los mejores productos 
                        para gamers, creadores de contenido y profesionales que buscan el máximo rendimiento.
                    </p>
                </div>

                <!-- Contacto -->
                <div class="space-y-4">
                    <h3 class="text-xl font-bold text-yellow-400">Contacto</h3>
                    <div class="space-y-2">
                        <div class="flex items-center space-x-2">
                            <i class="fas fa-map-marker-alt text-yellow-400"></i>
                            <span class="text-gray-300">Av. Principal #123, Ciudad</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <i class="fas fa-phone text-yellow-400"></i>
                            <span class="text-gray-300">+1 (555) 123-4567</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <i class="fas fa-envelope text-yellow-400"></i>
                            <span class="text-gray-300">info@pchub.com</span>
                        </div>
                    </div>
                </div>

                <!-- Horario -->
                <div class="space-y-4">
                    <h3 class="text-xl font-bold text-yellow-400">Horario</h3>
                    <div class="space-y-2 text-gray-300">
                        <p>Lunes - Viernes: 9:00 AM - 7:00 PM</p>
                        <p>Sábado: 10:00 AM - 5:00 PM</p>
                        <p>Domingo: Cerrado</p>
                    </div>
                </div>

                <!-- Redes Sociales -->
                <div class="space-y-4">
                    <h3 class="text-xl font-bold text-yellow-400">Síguenos</h3>
                    <div class="flex space-x-4">
                        <a href="#" class="text-gray-300 hover:text-yellow-400 transition-colors">
                            <i class="fab fa-facebook-f text-xl"></i>
                        </a>
                        <a href="#" class="text-gray-300 hover:text-yellow-400 transition-colors">
                            <i class="fab fa-twitter text-xl"></i>
                        </a>
                        <a href="#" class="text-gray-300 hover:text-yellow-400 transition-colors">
                            <i class="fab fa-instagram text-xl"></i>
                        </a>
                        <a href="#" class="text-gray-300 hover:text-yellow-400 transition-colors">
                            <i class="fab fa-youtube text-xl"></i>
                        </a>
                    </div>
                    <div class="pt-4">
                        <h4 class="text-lg font-semibold text-yellow-400">Newsletter</h4>
                        <div class="flex mt-2">
                            <input type="email" placeholder="Tu correo" 
                                class="bg-gray-700 text-white px-4 py-2 rounded-l-lg focus:outline-none focus:ring-2 focus:ring-yellow-400">
                            <button class="bg-yellow-400 text-gray-900 px-4 py-2 rounded-r-lg font-semibold hover:bg-yellow-500 transition-colors">
                                Suscribir
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Línea divisoria y copyright -->
            <div class="border-t border-gray-700 mt-12 pt-8 text-center text-gray-400">
                <p>&copy; 2024 PC HUB. Todos los derechos reservados.</p>
            </div>
        </div>
    </footer>

    <!-- Modal del carrito -->
    <div id="cartModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="absolute right-0 top-0 h-full w-full md:w-96 bg-gray-800 p-6">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold text-white">Carrito de compras</h2>
                <button class="modal-close text-gray-400 hover:text-white transition-colors p-2 rounded-lg hover:bg-gray-700">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div id="cartItems" class="space-y-4">
                <!-- Los items del carrito se cargarán aquí -->
            </div>
            <div class="mt-6 pt-6 border-t border-gray-700">
                <div class="flex justify-between text-white mb-4">
                    <span class="text-lg font-semibold">Total:</span>
                    <span id="cartTotal" class="text-xl font-bold text-yellow-400">$0.00</span>
                </div>
                <button id="checkoutButton" class="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-3 px-4 rounded-lg font-semibold hover:from-blue-700 hover:to-purple-700 transition-all flex items-center justify-center">
                    <i class="fas fa-credit-card mr-2"></i>
                    Proceder al pago
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de búsqueda -->
    <div id="searchModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="absolute top-20 left-1/2 transform -translate-x-1/2 w-full max-w-2xl bg-gray-800 rounded-lg p-6">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-white">Búsqueda avanzada</h2>
                <button class="modal-close text-gray-400 hover:text-white transition-colors p-2 rounded-lg hover:bg-gray-700">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div class="relative">
                <input type="text" id="searchModalInput" 
                    class="w-full bg-gray-700 text-white pl-10 pr-4 py-3 rounded-lg border border-gray-600 focus:border-blue-500 focus:ring-2 focus:ring-blue-500"
                    placeholder="Buscar productos...">
                <i class="fas fa-search absolute left-3 top-3.5 text-gray-400"></i>
                <button id="clearSearch" class="absolute right-3 top-3.5 text-gray-400 hover:text-white">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de usuario -->
    <div id="userModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="absolute top-20 right-4 w-80 bg-gray-800 rounded-lg shadow-xl">
            <div class="p-4 border-b border-gray-700 flex justify-between items-center">
                <h3 class="text-white font-semibold">Perfil de Usuario</h3>
                <button class="modal-close text-gray-400 hover:text-white transition-colors p-2 rounded-lg hover:bg-gray-700">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div class="p-4">
                <div class="text-gray-300 mb-4">
                    <p><i class="fas fa-envelope mr-2"></i><span id="userEmail"></span></p>
                </div>
                <button id="logoutButtonModal" class="w-full bg-red-600 text-white py-2 px-4 rounded-lg hover:bg-red-700 transition-colors">
                    <i class="fas fa-sign-out-alt mr-2"></i>Cerrar Sesión
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de pago -->
    <div id="paymentModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-full max-w-md bg-gray-800 rounded-lg p-6">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold text-white">Información de Pago</h2>
                <button class="modal-close text-gray-400 hover:text-white transition-colors p-2 rounded-lg hover:bg-gray-700">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <form id="paymentForm" class="space-y-4">
                <div>
                    <label class="block text-gray-300 mb-2">Número de Tarjeta</label>
                    <div class="relative">
                        <input type="text" id="cardNumber" 
                            class="w-full bg-gray-700 text-white pl-10 pr-4 py-2 rounded-lg border border-gray-600 focus:border-blue-500 focus:ring-2 focus:ring-blue-500"
                            placeholder="1234 5678 9012 3456" maxlength="19">
                        <i class="fas fa-credit-card absolute left-3 top-2.5 text-gray-400"></i>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-gray-300 mb-2">Fecha de Expiración</label>
                        <input type="text" id="expiryDate" 
                            class="w-full bg-gray-700 text-white px-4 py-2 rounded-lg border border-gray-600 focus:border-blue-500 focus:ring-2 focus:ring-blue-500"
                            placeholder="MM/AA" maxlength="5">
                    </div>
                    <div>
                        <label class="block text-gray-300 mb-2">CVV</label>
                        <input type="text" id="cvv" 
                            class="w-full bg-gray-700 text-white px-4 py-2 rounded-lg border border-gray-600 focus:border-blue-500 focus:ring-2 focus:ring-blue-500"
                            placeholder="123" maxlength="4">
                    </div>
                </div>
                <div>
                    <label class="block text-gray-300 mb-2">Nombre en la Tarjeta</label>
                    <input type="text" id="cardName" 
                        class="w-full bg-gray-700 text-white px-4 py-2 rounded-lg border border-gray-600 focus:border-blue-500 focus:ring-2 focus:ring-blue-500"
                        placeholder="NOMBRE APELLIDO">
                </div>
                <div class="mt-6">
                    <button type="submit" class="w-full bg-gradient-to-r from-green-600 to-blue-600 text-white py-3 px-4 rounded-lg font-semibold hover:from-green-700 hover:to-blue-700 transition-all flex items-center justify-center">
                        <i class="fas fa-lock mr-2"></i>
                        Pagar <span id="paymentAmount" class="ml-2"></span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de vista detallada del producto -->
    <div id="productDetailModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-full max-w-4xl bg-gray-800 rounded-lg shadow-xl overflow-hidden">
            <div class="flex justify-between items-center p-6 border-b border-gray-700">
                <h2 class="text-2xl font-bold text-white" id="productDetailTitle"></h2>
                <button class="modal-close text-gray-400 hover:text-white transition-colors p-2 rounded-lg hover:bg-gray-700">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 p-6">
                <div class="space-y-4">
                    <div class="relative aspect-square rounded-lg overflow-hidden bg-gray-700">
                        <img id="productDetailImage" class="w-full h-full object-cover hover:scale-105 transition-transform duration-300" src="" alt="">
                    </div>
                    <div class="flex justify-center space-x-2">
                        <span id="productDetailCategory" class="bg-blue-600 text-white px-3 py-1 rounded-full text-sm"></span>
                        <span id="productDetailPrice" class="bg-green-600 text-white px-3 py-1 rounded-full text-sm"></span>
                    </div>
                </div>
                <div class="space-y-6">
                    <div>
                        <h3 class="text-lg font-semibold text-white mb-2">Descripción</h3>
                        <p id="productDetailDescription" class="text-gray-300"></p>
                    </div>
                    <div>
                        <h3 class="text-lg font-semibold text-white mb-2">Especificaciones</h3>
                        <div id="productDetailSpecs" class="space-y-2 text-gray-300">
                            <!-- Las especificaciones se cargarán dinámicamente -->
                        </div>
                    </div>
                    <button id="productDetailAddToCart" class="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-3 px-4 rounded-lg font-semibold hover:from-blue-700 hover:to-purple-700 transition-all flex items-center justify-center">
                        <i class="fas fa-shopping-cart mr-2"></i>
                        Agregar al Carrito
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script>
        $(document).ready(function() {
            // Verificar si el usuario está autenticado
            const token = localStorage.getItem('token');
            //const user = JSON.parse(localStorage.getItem('user') || '{}');
            console.log("token: " + token); 
            if (!token) {
                window.location.href = 'index.html';
                return;
            }

            // Cerrar sesión
            $('#logoutBtn').click(function() {
                localStorage.clear(); // Limpiar todo el localStorage
                window.location.href = 'index.html';
            });

            // Abrir/cerrar carrito
            $('#cartBtn').click(function(e) {
                e.stopPropagation();
                closeAllModals();
                $('#cartModal').removeClass('hidden');
                updateCartDisplay();
            });

            let products = [];

            function fetchProducts() {
                // Mostrar el spinner al empezar
                $('#spinner').removeClass('hidden');

                $.get('/api/products', function(data) {
                    products = data;
                    renderProducts();
                }).fail(function() {
                    console.error('Error al cargar productos.');
                }).always(function() {
                    // Ocultar el spinner al terminar
                    $('#spinner').addClass('hidden');
                });
            }

            // Carrito de compras
            let cart = JSON.parse(localStorage.getItem('cart')) || [];

            // Variables para filtros
            let currentCategory = '';
            let currentSort = '';
            let currentSearch = '';

            // Función para filtrar y ordenar productos
            function filterAndSortProducts() {
                let filteredProducts = [...products];

                // Filtrar por categoría
                if (currentCategory) {
                    filteredProducts = filteredProducts.filter(product => product.category === currentCategory);
                }

                // Filtrar por búsqueda
                if (currentSearch) {
                    const searchTerm = currentSearch.toLowerCase();
                    filteredProducts = filteredProducts.filter(product => {
                        // Buscar en nombre y descripción
                        const nameMatch = product.name.toLowerCase().includes(searchTerm);
                        const descMatch = product.description.toLowerCase().includes(searchTerm);
                        
                        // Buscar en categoría
                        const categoryMatch = product.category.toLowerCase().includes(searchTerm);
                        
                        // Buscar en especificaciones
                        const specs = getProductSpecs(product);
                        const specsMatch = specs.some(spec => 
                            spec.label.toLowerCase().includes(searchTerm) || 
                            spec.value.toLowerCase().includes(searchTerm)
                        );

                        return nameMatch || descMatch || categoryMatch || specsMatch;
                    });
                }

                // Ordenar productos
                switch (currentSort) {
                    case 'price_asc':
                        filteredProducts.sort((a, b) => a.price - b.price);
                        break;
                    case 'price_desc':
                        filteredProducts.sort((a, b) => b.price - a.price);
                        break;
                    case 'name_asc':
                        filteredProducts.sort((a, b) => a.name.localeCompare(b.name));
                        break;
                    case 'name_desc':
                        filteredProducts.sort((a, b) => b.name.localeCompare(a.name));
                        break;
                }

                return filteredProducts;
            }

            // Eventos para filtros
            $('#categoryFilter').change(function() {
                currentCategory = $(this).val();
                renderProducts();
            });

            $('#sortFilter').change(function() {
                currentSort = $(this).val();
                renderProducts();
            });

            $('#searchInput').on('input', function() {
                currentSearch = $(this).val();
                renderProducts();
            });

            // Función para actualizar el carrito
            function updateCartDisplay() {
                const cartItems = $('#cartItems');
                const cartTotal = $('#cartTotal');
                const cartCount = $('#cartCount');
                
                cartItems.empty();
                let total = 0;

                cart.forEach(item => {
                    const product = products.find(p => p.id === item.id);
                    if (product) {
                        total += product.price * item.quantity;
                        cartItems.append(`
                            <div class="flex justify-between items-center bg-gray-700 p-4 rounded-lg">
                                <div>
                                    <h4 class="text-white">${product.name}</h4>
                                    <p class="text-gray-400">$${product.price} x ${item.quantity}</p>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <button class="text-blue-400 hover:text-blue-300 change-quantity" data-id="${product.id}" data-action="decrease">
                                        <i class="fas fa-minus"></i>
                                    </button>
                                    <span class="text-white">${item.quantity}</span>
                                    <button class="text-blue-400 hover:text-blue-300 change-quantity" data-id="${product.id}" data-action="increase">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                    <button class="text-red-400 hover:text-red-300 remove-from-cart" data-id="${product.id}">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        `);
                    }
                });

                cartTotal.text(`$${total.toFixed(2)}`);
                cartCount.text(cart.reduce((sum, item) => sum + item.quantity, 0));

                // Eventos para cambiar cantidad
                $('.change-quantity').click(function() {
                    const productId = $(this).data('id');
                    const action = $(this).data('action');
                    const item = cart.find(item => item.id === productId);
                    
                    if (action === 'increase') {
                        item.quantity += 1;
                    } else if (action === 'decrease' && item.quantity > 1) {
                        item.quantity -= 1;
                    }
                    
                    localStorage.setItem('cart', JSON.stringify(cart));
                    updateCartDisplay();
                });

                // Evento para eliminar productos del carrito
                $('.remove-from-cart').click(function() {
                    const productId = $(this).data('id');
                    cart = cart.filter(item => item.id !== productId);
                    localStorage.setItem('cart', JSON.stringify(cart));
                    updateCartDisplay();
                    
                    const product = products.find(p => p.id === productId);
                    showNotification(`¡${product.name} eliminado del carrito!`, 'info');
                });
            }

            // Función para renderizar productos modificada
            function renderProducts() {
                const grid = $('#productsGrid');
                grid.empty(); // Limpia el grid antes de volver a pintar

                const filteredProducts = filterAndSortProducts();

                if (filteredProducts.length === 0) {
                    // Mostrar un mensaje amigable si no hay productos
                    grid.append(`
                        <div class="col-span-full text-center mt-8">
                            <h2 class="text-2xl font-bold text-white">No hay productos disponibles</h2>
                            <p class="text-gray-400 mt-2">Por favor, vuelve más tarde.</p>
                        </div>
                    `);
                    return; // Terminar la función aquí
                }

                // Si sí hay productos, renderizarlos como siempre
                filteredProducts.forEach(product => {
                    grid.append(`
                        <div class="bg-gray-800 rounded-lg overflow-hidden shadow-lg transform hover:scale-105 transition-transform duration-300 cursor-pointer product-card" data-product-id="${product.id}">
                            <div class="relative">
                                <img src="${product.image}" alt="${product.name}" class="w-full h-48 object-cover hover:opacity-90 transition-opacity">
                                <div class="absolute top-2 right-2 bg-blue-600 text-white px-2 py-1 rounded text-sm">
                                    ${product.category.toUpperCase()}
                                </div>
                            </div>
                            <div class="p-4">
                                <h3 class="text-white font-semibold mb-2">${product.name}</h3>
                                <p class="text-gray-400 text-sm mb-2">${product.description}</p>
                                <div class="flex justify-between items-center">
                                    <p class="text-yellow-400 font-bold text-lg">$${product.price}</p>
                                    <button class="bg-gradient-to-r from-blue-600 to-purple-600 text-white py-2 px-4 rounded-lg font-semibold hover:from-blue-700 hover:to-purple-700 transition-all add-to-cart" data-id="${product.id}">
                                        <i class="fas fa-shopping-cart mr-2"></i>Agregar
                                    </button>
                                </div>
                            </div>
                        </div>
                    `);
                });

                // Actualizar contador de productos (opcional si tienes un contador)
                $('#productCount').text(`${filteredProducts.length} productos encontrados`);
            }

            // Función para mostrar detalles del producto
            function showProductDetails(productId) {
                const product = products.find(p => p.id === productId);
                if (!product) return;

                // Actualizar contenido del modal
                $('#productDetailTitle').text(product.name);
                $('#productDetailImage').attr('src', product.image);
                $('#productDetailCategory').text(product.category.toUpperCase());
                $('#productDetailPrice').text(`$${product.price}`);
                $('#productDetailDescription').text(product.description);

                // Generar especificaciones basadas en la categoría
                const specs = getProductSpecs(product);
                const specsHtml = specs.map(spec => `
                    <div class="flex justify-between">
                        <span class="text-gray-400">${spec.label}:</span>
                        <span class="text-white">${spec.value}</span>
                    </div>
                `).join('');
                $('#productDetailSpecs').html(specsHtml);

                // Configurar botón de agregar al carrito
                $('#productDetailAddToCart').data('product-id', product.id);

                // Mostrar modal
                $('#productDetailModal').removeClass('hidden');
            }

            // Función para generar especificaciones según la categoría
            function getProductSpecs(product) {
                const specs = [];
                switch (product.category) {
                    case 'cpu':
                        if (product.name.includes('Intel')) {
                            specs.push(
                                {label: 'Fabricante', value: 'Intel'},
                                {label: 'Socket', value: 'LGA 1700'},
                                {label: 'Tecnología', value: '10nm Intel 7'},
                                {label: 'TDP', value: '125W'}
                            );
                        } else {
                            specs.push(
                                {label: 'Fabricante', value: 'AMD'},
                                {label: 'Socket', value: 'AM5'},
                                {label: 'Tecnología', value: '5nm TSMC'},
                                {label: 'TDP', value: '170W'}
                            );
                        }
                        break;
                    case 'gpu':
                        if (product.name.includes('NVIDIA')) {
                            specs.push(
                                {label: 'Arquitectura', value: 'Ada Lovelace'},
                                {label: 'Ray Tracing', value: '3ra Generación'},
                                {label: 'DLSS', value: 'Versión 3.0'},
                                {label: 'Tecnología', value: '4nm TSMC'}
                            );
                        } else {
                            specs.push(
                                {label: 'Arquitectura', value: 'RDNA 3'},
                                {label: 'Ray Tracing', value: '2da Generación'},
                                {label: 'FSR', value: 'Versión 3.0'},
                                {label: 'Tecnología', value: '5nm TSMC'}
                            );
                        }
                        break;
                    // Agregar más casos según sea necesario
                }
                return specs;
            }

            // Evento para abrir detalles del producto
            $(document).on('click', '.product-card', function(e) {
                if (!$(e.target).closest('.add-to-cart').length) {
                    const productId = $(this).data('product-id');
                    showProductDetails(productId);
                }
            });

            // Evento para agregar al carrito desde la página principal
            $(document).on('click', '.add-to-cart', function(e) {
                e.stopPropagation(); // Evitar que se abra el modal de detalles
                const productId = $(this).data('id');
                const existingItem = cart.find(item => item.id === productId);
                
                if (existingItem) {
                    existingItem.quantity += 1;
                } else {
                    cart.push({ id: productId, quantity: 1 });
                }
                
                localStorage.setItem('cart', JSON.stringify(cart));
                updateCartDisplay();
                
                const product = products.find(p => p.id === productId);
                showNotification(`¡${product.name} agregado al carrito!`);
            });

            // Función para proceder al pago
            $('#checkoutButton').click(function() {
                if (cart.length === 0) {
                    showNotification('El carrito está vacío', 'error');
                    return;
                }

                const total = cart.reduce((sum, item) => {
                    const product = products.find(p => p.id === item.id);
                    return sum + (product.price * item.quantity);
                }, 0);

                // Mostrar resumen de la compra
                const orderSummary = `
                    Total de la compra: $${total.toFixed(2)}
                    Número de productos: ${cart.reduce((sum, item) => sum + item.quantity, 0)}
                    
                    ¿Desea confirmar su compra?
                `;

                if (confirm(orderSummary)) {
                    // Simular proceso de pago
                    showNotification('Procesando su pago...', 'info');
                    
                    setTimeout(() => {
                        // Limpiar carrito
                        cart = [];
                        localStorage.setItem('cart', JSON.stringify(cart));
                        updateCartDisplay();
                        
                        // Cerrar modal del carrito
                        $('#cartModal').addClass('hidden');
                        
                        // Mostrar confirmación
                        showNotification('¡Compra realizada con éxito!', 'success');
                    }, 2000);
                }
            });

            // Función mejorada para mostrar notificaciones
            function showNotification(message, type = 'success') {
                const bgColor = {
                    success: 'bg-green-600',
                    error: 'bg-red-600',
                    info: 'bg-blue-600'
                };

                const notification = $(`
                    <div class="fixed bottom-4 right-4 ${bgColor[type]} text-white px-6 py-3 rounded-lg shadow-lg transform transition-all duration-300 opacity-0 flex items-center">
                        <i class="fas ${type === 'success' ? 'fa-check' : type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle'} mr-2"></i>
                        ${message}
                    </div>
                `);
                
                $('body').append(notification);
                notification.animate({ opacity: 1, bottom: '20px' }, 300);
                
                setTimeout(() => {
                    notification.animate({ opacity: 0, bottom: '16px' }, 300, function() {
                        notification.remove();
                    });
                }, 3000);
            }

            // Función para cerrar todos los modales
            function closeAllModals() {
                $('#searchModal, #userModal, #cartModal, #paymentModal, #productDetailModal').addClass('hidden');
            }

            // Cerrar modal al hacer clic en el botón de cierre
            $('.modal-close').click(function() {
                $(this).closest('.fixed').addClass('hidden');
            });

            // Cerrar modal al hacer clic fuera del contenido
            $('.fixed').click(function(e) {
                if (e.target === this) {
                    $(this).addClass('hidden');
                }
            });

            // Cerrar modal con la tecla ESC
            $(document).keydown(function(e) {
                if (e.key === 'Escape') {
                    closeAllModals();
                }
            });

            // Modificar los eventos existentes para usar las nuevas funciones
            $('.fa-search').parent().click(function(e) {
                e.stopPropagation();
                closeAllModals();
                $('#searchModal').removeClass('hidden');
                $('#searchModalInput').focus();
            });

            // Evento para la búsqueda avanzada
            $('#searchModalInput').on('input', function() {
                currentSearch = $(this).val();
                renderProducts();
            });

            // Evento para cerrar el modal al presionar Enter
            $('#searchModalInput').keypress(function(e) {
                if (e.which === 13) { // 13 es el código de la tecla Enter
                    $('#searchModal').addClass('hidden');
                }
            });

            // Evento para cerrar el modal de búsqueda sin limpiar la búsqueda
            $('#searchModal .modal-close').click(function() {
                $('#searchModal').addClass('hidden');
            });

            // Evento para limpiar la búsqueda (nuevo botón)
            $('#clearSearch').click(function() {
                currentSearch = '';
                $('#searchModalInput').val('');
                renderProducts();
            });

            $('#logoutBtn').click(function(e) {
                e.stopPropagation();
                closeAllModals();
                const user = JSON.parse(localStorage.getItem('user') || '{}');
                $('#userEmail').text(user.email || 'Usuario');
                $('#userModal').removeClass('hidden');
            });

            // Modificar el checkout para usar el nuevo sistema
            $('#checkoutButton').click(function() {
                if (cart.length === 0) {
                    showNotification('El carrito está vacío', 'error');
                    return;
                }

                const total = cart.reduce((sum, item) => {
                    const product = products.find(p => p.id === item.id);
                    return sum + (product.price * item.quantity);
                }, 0);

                $('#paymentAmount').text(`$${total.toFixed(2)}`);
                closeAllModals();
                $('#paymentModal').removeClass('hidden');
            });

            // Formateo de tarjeta de crédito
            $('#cardNumber').on('input', function() {
                let value = $(this).val().replace(/\D/g, '');
                value = value.replace(/(.{4})/g, '$1 ').trim();
                $(this).val(value);
            });

            // Formateo de fecha de expiración
            $('#expiryDate').on('input', function() {
                let value = $(this).val().replace(/\D/g, '');
                if (value.length > 2) {
                    value = value.substring(0, 2) + '/' + value.substring(2);
                }
                $(this).val(value);
            });

            // Validación del formulario de pago
            $('#paymentForm').submit(function(e) {
                e.preventDefault();
                
                const cardNumber = $('#cardNumber').val().replace(/\s/g, '');
                const expiryDate = $('#expiryDate').val();
                const cvv = $('#cvv').val();
                const cardName = $('#cardName').val();

                if (cardNumber.length < 16) {
                    showNotification('Número de tarjeta inválido', 'error');
                    return;
                }

                if (expiryDate.length < 5) {
                    showNotification('Fecha de expiración inválida', 'error');
                    return;
                }

                if (cvv.length < 3) {
                    showNotification('CVV inválido', 'error');
                    return;
                }

                if (cardName.length < 3) {
                    showNotification('Nombre inválido', 'error');
                    return;
                }

                // Simular procesamiento de pago
                showNotification('Procesando pago...', 'info');
                
                setTimeout(() => {
                    // Limpiar carrito
                    cart = [];
                    localStorage.setItem('cart', JSON.stringify(cart));
                    updateCartDisplay();
                    
                    // Cerrar modal de pago
                    $('#paymentModal').addClass('hidden');
                    
                    // Mostrar confirmación
                    showNotification('¡Pago realizado con éxito!', 'success');
                    
                    // Limpiar formulario
                    $('#paymentForm')[0].reset();
                }, 2000);
            });

            // Evento para agregar al carrito desde el modal de detalle
            $('#productDetailAddToCart').click(function() {
                const productId = $(this).data('product-id');
                const existingItem = cart.find(item => item.id === productId);
                
                if (existingItem) {
                    existingItem.quantity += 1;
                } else {
                    cart.push({ id: productId, quantity: 1 });
                }
                
                localStorage.setItem('cart', JSON.stringify(cart));
                updateCartDisplay();
                
                const product = products.find(p => p.id === productId);
                showNotification(`¡${product.name} agregado al carrito!`);
            });

            // Inicializar la página
            console.log('Inicializando página...'); 
            fetchProducts();
            updateCartDisplay();

            // Carrusel de productos destacados
            const featuredProducts = [
                {
                    id: 7,
                    title: 'NVIDIA RTX 4090',
                    description: 'La tarjeta gráfica más potente del mercado',
                    image: 'images/gpu/NVIDIA RTX 4090.jpg',
                    price: 1599.99
                },
                {
                    id: 1,
                    title: 'Intel Core i9-13900K',
                    description: 'El procesador más rápido para gaming',
                    image: 'images/cpu/Intel Core i9-13900K.jpg',
                    price: 799.99
                },
                {
                    id: 16,
                    title: 'Samsung 990 Pro 2TB',
                    description: 'Almacenamiento ultrarrápido PCIe 4.0',
                    image: 'images/storage/Samsung 990 Pro 2TB.webp',
                    price: 249.99
                }
            ];

            let currentSlide = 0;
            const carousel = $('#featuredCarousel');
            const indicators = $('#carouselIndicators');

            // Inicializar carrusel
            function initCarousel() {
                carousel.empty();
                indicators.empty();

                featuredProducts.forEach((product, index) => {
                    // Agregar slide
                    carousel.append(`
                        <div class="w-full flex-shrink-0 relative h-full">
                            <div class="absolute inset-0">
                                <img src="${product.image}" alt="${product.title}" 
                                    class="w-full h-full object-contain bg-gray-900">
                            </div>
                            <div class="absolute inset-0 bg-gradient-to-t from-black/90 via-black/50 to-transparent flex items-end p-8">
                                <div class="text-white w-full">
                                    <h3 class="text-2xl font-bold mb-2">${product.title}</h3>
                                    <p class="text-gray-300 mb-4">${product.description}</p>
                                    <div class="flex items-center justify-between">
                                        <span class="text-yellow-400 text-xl font-bold">$${product.price}</span>
                                        <button class="bg-gradient-to-r from-blue-600 to-purple-600 text-white py-2 px-4 rounded-lg font-semibold hover:from-blue-700 hover:to-purple-700 transition-all add-to-cart" 
                                                data-id="${product.id}">
                                            <i class="fas fa-shopping-cart mr-2"></i>Agregar
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `);

                    // Agregar indicador
                    indicators.append(`
                        <button class="w-3 h-3 rounded-full bg-white/50 hover:bg-white transition-colors ${index === 0 ? 'bg-white' : ''}"
                                data-slide="${index}"></button>
                    `);
                });

                updateCarousel();
            }

            // Actualizar posición del carrusel
            function updateCarousel() {
                carousel.css('transform', `translateX(-${currentSlide * 100}%)`);
                indicators.find('button').removeClass('bg-white').addClass('bg-white/50');
                indicators.find(`button[data-slide="${currentSlide}"]`).removeClass('bg-white/50').addClass('bg-white');
            }

            // Navegación del carrusel
            $('#prevSlide').click(function() {
                currentSlide = (currentSlide - 1 + featuredProducts.length) % featuredProducts.length;
                updateCarousel();
            });

            $('#nextSlide').click(function() {
                currentSlide = (currentSlide + 1) % featuredProducts.length;
                updateCarousel();
            });

            // Navegación por indicadores
            indicators.on('click', 'button', function() {
                currentSlide = parseInt($(this).data('slide'));
                updateCarousel();
            });

            // Autoplay del carrusel
            setInterval(function() {
                currentSlide = (currentSlide + 1) % featuredProducts.length;
                updateCarousel();
            }, 5000);

            // Inicializar el carrusel
            initCarousel();
        });
    </script>
</body>
</html> 