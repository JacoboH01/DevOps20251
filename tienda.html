<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PC HUB - Tienda</title>
    <!-- Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>
<body class="bg-gray-900 min-h-screen">
    <!-- Barra de navegación -->
    <nav class="bg-gray-800 text-white p-4">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-2xl font-bold">PC<span class="text-yellow-400">HUB</span></h1>
            <div class="flex items-center space-x-4">
                <a href="admin.html" class="hover:text-yellow-400">
                    <i class="fas fa-cog"></i> Admin
                </a>
                <button id="cartBtn" class="hover:text-yellow-400">
                    <i class="fas fa-shopping-cart"></i>
                    <span id="cartCount" class="bg-yellow-400 text-black px-2 py-1 rounded-full text-xs">0</span>
                </button>
                <button id="logoutBtn" class="bg-red-600 px-4 py-2 rounded hover:bg-red-700">
                    <i class="fas fa-sign-out-alt"></i> Cerrar Sesión
                </button>
            </div>
        </div>
    </nav>

    <!-- Contenido principal con padding-top para compensar la navbar fija -->
    <main class="max-w-7xl mx-auto px-4 py-8 mt-16">
        <!-- Filtros y búsqueda -->
        <div class="mb-8 flex flex-col md:flex-row justify-between items-center space-y-4 md:space-y-0">
            <div class="flex space-x-4">
                <select id="categoryFilter" class="bg-gray-700 text-white rounded-lg px-4 py-2">
                    <option value="">Todas las categorías</option>
                    <option value="cpu">Procesadores</option>
                    <option value="gpu">Tarjetas gráficas</option>
                    <option value="ram">Memoria RAM</option>
                    <option value="storage">Almacenamiento</option>
                    <option value="motherboard">Placas Madre</option>
                    <option value="psu">Fuentes de Poder</option>
                    <option value="cooling">Refrigeración</option>
                    <option value="case">Gabinetes</option>
                </select>
                <select id="sortFilter" class="bg-gray-700 text-white rounded-lg px-4 py-2">
                    <option value="">Ordenar por</option>
                    <option value="price_asc">Precio: Menor a Mayor</option>
                    <option value="price_desc">Precio: Mayor a Menor</option>
                    <option value="name_asc">Nombre: A-Z</option>
                    <option value="name_desc">Nombre: Z-A</option>
                </select>
            </div>
            <div class="relative">
                <input type="text" id="searchInput" placeholder="Buscar productos..." 
                    class="bg-gray-700 text-white rounded-lg pl-10 pr-4 py-2 w-64">
                <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
            </div>
        </div>

        <!-- Grid de productos -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6" id="productsGrid">
            <!-- Los productos se cargarán dinámicamente aquí -->
        </div>
    </main>

    <!-- Modal del carrito -->
    <div id="cartModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="absolute right-0 top-0 h-full w-full md:w-96 bg-gray-800 p-6">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold text-white">Carrito de compras</h2>
                <button class="modal-close text-gray-400 hover:text-white transition-colors p-2 rounded-lg hover:bg-gray-700">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div id="cartItems" class="space-y-4">
                <!-- Los items del carrito se cargarán aquí -->
            </div>
            <div class="mt-6 pt-6 border-t border-gray-700">
                <div class="flex justify-between text-white mb-4">
                    <span class="text-lg font-semibold">Total:</span>
                    <span id="cartTotal" class="text-xl font-bold text-yellow-400">$0.00</span>
                </div>
                <button id="checkoutButton" class="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-3 px-4 rounded-lg font-semibold hover:from-blue-700 hover:to-purple-700 transition-all flex items-center justify-center">
                    <i class="fas fa-credit-card mr-2"></i>
                    Proceder al pago
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de búsqueda -->
    <div id="searchModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="absolute top-20 left-1/2 transform -translate-x-1/2 w-full max-w-2xl bg-gray-800 rounded-lg p-6">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-white">Búsqueda avanzada</h2>
                <button class="modal-close text-gray-400 hover:text-white transition-colors p-2 rounded-lg hover:bg-gray-700">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div class="relative">
                <input type="text" id="searchModalInput" 
                    class="w-full bg-gray-700 text-white pl-10 pr-4 py-3 rounded-lg border border-gray-600 focus:border-blue-500 focus:ring-2 focus:ring-blue-500"
                    placeholder="Buscar productos...">
                <i class="fas fa-search absolute left-3 top-3.5 text-gray-400"></i>
            </div>
        </div>
    </div>

    <!-- Modal de usuario -->
    <div id="userModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="absolute top-20 right-4 w-80 bg-gray-800 rounded-lg shadow-xl">
            <div class="p-4 border-b border-gray-700 flex justify-between items-center">
                <h3 class="text-white font-semibold">Perfil de Usuario</h3>
                <button class="modal-close text-gray-400 hover:text-white transition-colors p-2 rounded-lg hover:bg-gray-700">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div class="p-4">
                <div class="text-gray-300 mb-4">
                    <p><i class="fas fa-envelope mr-2"></i><span id="userEmail"></span></p>
                </div>
                <button id="logoutButtonModal" class="w-full bg-red-600 text-white py-2 px-4 rounded-lg hover:bg-red-700 transition-colors">
                    <i class="fas fa-sign-out-alt mr-2"></i>Cerrar Sesión
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de pago -->
    <div id="paymentModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-full max-w-md bg-gray-800 rounded-lg p-6">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold text-white">Información de Pago</h2>
                <button class="modal-close text-gray-400 hover:text-white transition-colors p-2 rounded-lg hover:bg-gray-700">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <form id="paymentForm" class="space-y-4">
                <div>
                    <label class="block text-gray-300 mb-2">Número de Tarjeta</label>
                    <div class="relative">
                        <input type="text" id="cardNumber" 
                            class="w-full bg-gray-700 text-white pl-10 pr-4 py-2 rounded-lg border border-gray-600 focus:border-blue-500 focus:ring-2 focus:ring-blue-500"
                            placeholder="1234 5678 9012 3456" maxlength="19">
                        <i class="fas fa-credit-card absolute left-3 top-2.5 text-gray-400"></i>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-gray-300 mb-2">Fecha de Expiración</label>
                        <input type="text" id="expiryDate" 
                            class="w-full bg-gray-700 text-white px-4 py-2 rounded-lg border border-gray-600 focus:border-blue-500 focus:ring-2 focus:ring-blue-500"
                            placeholder="MM/AA" maxlength="5">
                    </div>
                    <div>
                        <label class="block text-gray-300 mb-2">CVV</label>
                        <input type="text" id="cvv" 
                            class="w-full bg-gray-700 text-white px-4 py-2 rounded-lg border border-gray-600 focus:border-blue-500 focus:ring-2 focus:ring-blue-500"
                            placeholder="123" maxlength="4">
                    </div>
                </div>
                <div>
                    <label class="block text-gray-300 mb-2">Nombre en la Tarjeta</label>
                    <input type="text" id="cardName" 
                        class="w-full bg-gray-700 text-white px-4 py-2 rounded-lg border border-gray-600 focus:border-blue-500 focus:ring-2 focus:ring-blue-500"
                        placeholder="NOMBRE APELLIDO">
                </div>
                <div class="mt-6">
                    <button type="submit" class="w-full bg-gradient-to-r from-green-600 to-blue-600 text-white py-3 px-4 rounded-lg font-semibold hover:from-green-700 hover:to-blue-700 transition-all flex items-center justify-center">
                        <i class="fas fa-lock mr-2"></i>
                        Pagar <span id="paymentAmount" class="ml-2"></span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de vista detallada del producto -->
    <div id="productDetailModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-full max-w-4xl bg-gray-800 rounded-lg shadow-xl overflow-hidden">
            <div class="flex justify-between items-center p-6 border-b border-gray-700">
                <h2 class="text-2xl font-bold text-white" id="productDetailTitle"></h2>
                <button class="modal-close text-gray-400 hover:text-white transition-colors p-2 rounded-lg hover:bg-gray-700">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 p-6">
                <div class="space-y-4">
                    <div class="relative aspect-square rounded-lg overflow-hidden bg-gray-700">
                        <img id="productDetailImage" class="w-full h-full object-cover hover:scale-105 transition-transform duration-300" src="" alt="">
                    </div>
                    <div class="flex justify-center space-x-2">
                        <span id="productDetailCategory" class="bg-blue-600 text-white px-3 py-1 rounded-full text-sm"></span>
                        <span id="productDetailPrice" class="bg-green-600 text-white px-3 py-1 rounded-full text-sm"></span>
                    </div>
                </div>
                <div class="space-y-6">
                    <div>
                        <h3 class="text-lg font-semibold text-white mb-2">Descripción</h3>
                        <p id="productDetailDescription" class="text-gray-300"></p>
                    </div>
                    <div>
                        <h3 class="text-lg font-semibold text-white mb-2">Especificaciones</h3>
                        <div id="productDetailSpecs" class="space-y-2 text-gray-300">
                            <!-- Las especificaciones se cargarán dinámicamente -->
                        </div>
                    </div>
                    <button id="productDetailAddToCart" class="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-3 px-4 rounded-lg font-semibold hover:from-blue-700 hover:to-purple-700 transition-all flex items-center justify-center">
                        <i class="fas fa-shopping-cart mr-2"></i>
                        Agregar al Carrito
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script>
        $(document).ready(function() {
            // Verificar si el usuario está autenticado
            const token = localStorage.getItem('token');
            const user = JSON.parse(localStorage.getItem('user') || '{}');
            
            if (!token || !user.email) {
                window.location.href = 'index.html';
                return;
            }

            // Cerrar sesión
            $('#logoutBtn').click(function() {
                localStorage.clear(); // Limpiar todo el localStorage
                window.location.href = 'index.html';
            });

            // Abrir/cerrar carrito
            $('#cartBtn').click(function(e) {
                e.stopPropagation();
                closeAllModals();
                $('#cartModal').removeClass('hidden');
                updateCartDisplay();
            });

            // Datos de ejemplo de productos
            const products = [
                // Procesadores Intel
                {
                    id: 1,
                    name: 'Intel Core i9-13900K',
                    price: 799.99,
                    image: 'images/cpu/Intel Core i9-13900K.jpg',
                    category: 'cpu',
                    description: '24 núcleos (8P + 16E) / 32 hilos, hasta 5.8GHz'
                },
                {
                    id: 2,
                    name: 'Intel Core i7-13700K',
                    price: 499.99,
                    image: 'images/cpu/Intel Core i7-13700K.webp',
                    category: 'cpu',
                    description: '16 núcleos (8P + 8E) / 24 hilos, hasta 5.4GHz'
                },
                {
                    id: 3,
                    name: 'Intel Core i5-13600K',
                    price: 349.99,
                    image: 'images/cpu/Intel Core i5-13600K.webp',
                    category: 'cpu',
                    description: '14 núcleos (6P + 8E) / 20 hilos, hasta 5.1GHz'
                },
                // Procesadores AMD
                {
                    id: 4,
                    name: 'AMD Ryzen 9 7950X',
                    price: 699.99,
                    image: 'images/cpu/AMD Ryzen 9 7950X.jpg',
                    category: 'cpu',
                    description: '16 núcleos / 32 hilos, hasta 5.7GHz'
                },
                {
                    id: 5,
                    name: 'AMD Ryzen 7 7800X3D',
                    price: 449.99,
                    image: 'images/cpu/AMD Ryzen 7 7800X3D.jpg',
                    category: 'cpu',
                    description: '8 núcleos / 16 hilos, 3D V-Cache, hasta 5.0GHz'
                },
                {
                    id: 6,
                    name: 'AMD Ryzen 5 7600X',
                    price: 299.99,
                    image: 'images/cpu/AMD Ryzen 5 7600X.jpg',
                    category: 'cpu',
                    description: '6 núcleos / 12 hilos, hasta 5.3GHz'
                },
                // Tarjetas Gráficas NVIDIA
                {
                    id: 7,
                    name: 'NVIDIA RTX 4090',
                    price: 1599.99,
                    image: 'images/gpu/NVIDIA RTX 4090.jpg',
                    category: 'gpu',
                    description: '24GB GDDR6X, DLSS 3.0, 16384 CUDA Cores'
                },
                {
                    id: 8,
                    name: 'NVIDIA RTX 4080',
                    price: 1199.99,
                    image: 'images/gpu/NVIDIA RTX 4080.jpg',
                    category: 'gpu',
                    description: '16GB GDDR6X, DLSS 3.0, 9728 CUDA Cores'
                },
                {
                    id: 9,
                    name: 'NVIDIA RTX 4070 Ti',
                    price: 799.99,
                    image: 'images/gpu/NVIDIA RTX 4070 Ti.jpg',
                    category: 'gpu',
                    description: '12GB GDDR6X, DLSS 3.0, 7680 CUDA Cores'
                },
                // Tarjetas Gráficas AMD
                {
                    id: 10,
                    name: 'AMD Radeon RX 7900 XTX',
                    price: 999.99,
                    image: 'images/gpu/AMD Radeon RX 7900 XTX.jpg',
                    category: 'gpu',
                    description: '24GB GDDR6, FSR 3.0, 6144 Stream Processors'
                },
                {
                    id: 11,
                    name: 'AMD Radeon RX 7900 XT',
                    price: 899.99,
                    image: 'images/gpu/AMD Radeon RX 7900 XT.jpg',
                    category: 'gpu',
                    description: '20GB GDDR6, FSR 3.0, 5376 Stream Processors'
                },
                {
                    id: 12,
                    name: 'AMD Radeon RX 7800 XT',
                    price: 499.99,
                    image: 'images/gpu/AMD Radeon RX 7800 XT.jpg',
                    category: 'gpu',
                    description: '16GB GDDR6, FSR 3.0, 3840 Stream Processors'
                },
                // Memoria RAM
                {
                    id: 13,
                    name: 'Corsair Dominator Platinum RGB 32GB',
                    price: 199.99,
                    image: 'images/ram/Corsair Dominator Platinum RGB 32GB.webp',
                    category: 'ram',
                    description: 'DDR5 6000MHz, CL36, RGB'
                },
                {
                    id: 14,
                    name: 'G.Skill Trident Z5 RGB 64GB',
                    price: 349.99,
                    image: 'images/ram/G.Skill Trident Z5 RGB 64GB.webp',
                    category: 'ram',
                    description: 'DDR5 6400MHz, CL32, RGB'
                },
                {
                    id: 15,
                    name: 'Kingston Fury Beast 32GB',
                    price: 149.99,
                    image: 'images/ram/Kingston Fury Beast 32GB.webp',
                    category: 'ram',
                    description: 'DDR4 3600MHz, CL18'
                },
                // Almacenamiento
                {
                    id: 16,
                    name: 'Samsung 990 Pro 2TB',
                    price: 249.99,
                    image: 'images/storage/Samsung 990 Pro 2TB.webp',
                    category: 'storage',
                    description: 'PCIe 4.0, 7450MB/s, 6900MB/s'
                },
                {
                    id: 17,
                    name: 'WD Black SN850X 4TB',
                    price: 399.99,
                    image: 'images/storage/WD Black SN850X 4TB.webp',
                    category: 'storage',
                    description: 'PCIe 4.0, 7300MB/s, 6600MB/s'
                },
                {
                    id: 18,
                    name: 'Seagate FireCuda 530 1TB',
                    price: 129.99,
                    image: 'images/storage/Seagate FireCuda 530 1TB.webp',
                    category: 'storage',
                    description: 'PCIe 4.0, 7300MB/s, 6000MB/s'
                },
                // Placas Madre Intel
                {
                    id: 19,
                    name: 'ASUS ROG Maximus Z790',
                    price: 499.99,
                    image: 'images/motherboard/ASUS ROG Maximus Z790.png',
                    category: 'motherboard',
                    description: 'Z790, WiFi 6E, RGB, DDR5'
                },
                {
                    id: 20,
                    name: 'MSI MPG Z790 Carbon',
                    price: 399.99,
                    image: 'images/motherboard/MSI MPG Z790 Carbon.png',
                    category: 'motherboard',
                    description: 'Z790, WiFi 6E, RGB, DDR5'
                },
                // Placas Madre AMD
                {
                    id: 21,
                    name: 'ASUS ROG Crosshair X670E',
                    price: 449.99,
                    image: 'images/motherboard/ASUS ROG Crosshair X670E.png',
                    category: 'motherboard',
                    description: 'X670E, WiFi 6E, RGB, DDR5'
                },
                {
                    id: 22,
                    name: 'Gigabyte X670 Aorus Elite',
                    price: 299.99,
                    image: 'images/motherboard/Gigabyte X670 Aorus Elite.png',
                    category: 'motherboard',
                    description: 'X670, WiFi 6, RGB, DDR5'
                },
                // Fuentes de Poder
                {
                    id: 23,
                    name: 'Corsair RM1000x',
                    price: 199.99,
                    image: 'images/psu/Corsair RM1000x.jpg',
                    category: 'psu',
                    description: '1000W, 80+ Gold, Modular'
                },
                {
                    id: 24,
                    name: 'Seasonic PRIME TX-1300',
                    price: 299.99,
                    image: 'images/psu/Seasonic PRIME TX-1300.jpg',
                    category: 'psu',
                    description: '1300W, 80+ Titanium, Modular'
                },
                {
                    id: 25,
                    name: 'EVGA SuperNOVA 850 G6',
                    price: 149.99,
                    image: 'images/psu/EVGA SuperNOVA 850 G6.png',
                    category: 'psu',
                    description: '850W, 80+ Gold, Modular'
                },
                // Refrigeración
                {
                    id: 26,
                    name: 'Corsair iCUE H150i Elite',
                    price: 199.99,
                    image: 'images/cooling/Corsair iCUE H150i Elite.webp',
                    category: 'cooling',
                    description: '360mm, RGB, LCD Display'
                },
                {
                    id: 27,
                    name: 'NZXT Kraken X73',
                    price: 179.99,
                    image: 'images/cooling/NZXT Kraken X73.webp',
                    category: 'cooling',
                    description: '360mm, RGB, LCD Display'
                },
                {
                    id: 28,
                    name: 'Noctua NH-D15',
                    price: 99.99,
                    image: 'images/cooling/Noctua NH-D15.webp',
                    category: 'cooling',
                    description: 'Doble torre, 2 ventiladores'
                },
                // Gabinetes
                {
                    id: 29,
                    name: 'Lian Li O11 Dynamic EVO',
                    price: 159.99,
                    image: 'images/case/Lian Li O11 Dynamic EVO.jpg',
                    category: 'case',
                    description: 'Mid Tower, Cristal Templado, RGB'
                },
                {
                    id: 30,
                    name: 'Fractal Design Torrent',
                    price: 199.99,
                    image: 'images/case/Fractal Design Torrent.webp',
                    category: 'case',
                    description: 'Full Tower, Cristal Templado'
                },
                {
                    id: 31,
                    name: 'Corsair 4000D Airflow',
                    price: 94.99,
                    image: 'images/case/Corsair 4000D Airflow.webp',
                    category: 'case',
                    description: 'Mid Tower, Cristal Templado'
                }
            ];

            // Carrito de compras
            let cart = JSON.parse(localStorage.getItem('cart')) || [];

            // Variables para filtros
            let currentCategory = '';
            let currentSort = '';
            let currentSearch = '';

            // Función para filtrar y ordenar productos
            function filterAndSortProducts() {
                let filteredProducts = [...products];

                // Filtrar por categoría
                if (currentCategory) {
                    filteredProducts = filteredProducts.filter(product => product.category === currentCategory);
                }

                // Filtrar por búsqueda
                if (currentSearch) {
                    const searchTerm = currentSearch.toLowerCase();
                    filteredProducts = filteredProducts.filter(product => 
                        product.name.toLowerCase().includes(searchTerm) ||
                        product.description.toLowerCase().includes(searchTerm)
                    );
                }

                // Ordenar productos
                switch (currentSort) {
                    case 'price_asc':
                        filteredProducts.sort((a, b) => a.price - b.price);
                        break;
                    case 'price_desc':
                        filteredProducts.sort((a, b) => b.price - a.price);
                        break;
                    case 'name_asc':
                        filteredProducts.sort((a, b) => a.name.localeCompare(b.name));
                        break;
                    case 'name_desc':
                        filteredProducts.sort((a, b) => b.name.localeCompare(a.name));
                        break;
                }

                return filteredProducts;
            }

            // Eventos para filtros
            $('#categoryFilter').change(function() {
                currentCategory = $(this).val();
                renderProducts();
            });

            $('#sortFilter').change(function() {
                currentSort = $(this).val();
                renderProducts();
            });

            $('#searchInput').on('input', function() {
                currentSearch = $(this).val();
                renderProducts();
            });

            // Función para actualizar el carrito
            function updateCartDisplay() {
                const cartItems = $('#cartItems');
                const cartTotal = $('#cartTotal');
                const cartCount = $('#cartCount');
                
                cartItems.empty();
                let total = 0;

                cart.forEach(item => {
                    const product = products.find(p => p.id === item.id);
                    if (product) {
                        total += product.price * item.quantity;
                        cartItems.append(`
                            <div class="flex justify-between items-center bg-gray-700 p-4 rounded-lg">
                                <div>
                                    <h4 class="text-white">${product.name}</h4>
                                    <p class="text-gray-400">$${product.price} x ${item.quantity}</p>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <button class="text-blue-400 hover:text-blue-300 change-quantity" data-id="${product.id}" data-action="decrease">
                                        <i class="fas fa-minus"></i>
                                    </button>
                                    <span class="text-white">${item.quantity}</span>
                                    <button class="text-blue-400 hover:text-blue-300 change-quantity" data-id="${product.id}" data-action="increase">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                    <button class="text-red-400 hover:text-red-300 remove-from-cart" data-id="${product.id}">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        `);
                    }
                });

                cartTotal.text(`$${total.toFixed(2)}`);
                cartCount.text(cart.reduce((sum, item) => sum + item.quantity, 0));

                // Eventos para cambiar cantidad
                $('.change-quantity').click(function() {
                    const productId = $(this).data('id');
                    const action = $(this).data('action');
                    const item = cart.find(item => item.id === productId);
                    
                    if (action === 'increase') {
                        item.quantity += 1;
                    } else if (action === 'decrease' && item.quantity > 1) {
                        item.quantity -= 1;
                    }
                    
                    localStorage.setItem('cart', JSON.stringify(cart));
                    updateCartDisplay();
                });
            }

            // Función para renderizar productos modificada
            function renderProducts() {
                console.log('Renderizando productos...');
                const grid = $('#productsGrid');
                grid.empty();

                const filteredProducts = filterAndSortProducts();

                filteredProducts.forEach(product => {
                    grid.append(`
                        <div class="bg-gray-800 rounded-lg overflow-hidden shadow-lg transform hover:scale-105 transition-transform duration-300 cursor-pointer product-card" data-product-id="${product.id}">
                            <div class="relative">
                                <img src="${product.image}" alt="${product.name}" 
                                    class="w-full h-48 object-cover hover:opacity-90 transition-opacity">
                                <div class="absolute top-2 right-2 bg-blue-600 text-white px-2 py-1 rounded text-sm">
                                    ${product.category.toUpperCase()}
                                </div>
                            </div>
                            <div class="p-4">
                                <h3 class="text-white font-semibold mb-2">${product.name}</h3>
                                <p class="text-gray-400 text-sm mb-2 line-clamp-2">${product.description}</p>
                                <div class="flex justify-between items-center">
                                    <p class="text-yellow-400 font-bold text-lg">$${product.price}</p>
                                    <button class="bg-gradient-to-r from-blue-600 to-purple-600 text-white py-2 px-4 rounded-lg font-semibold hover:from-blue-700 hover:to-purple-700 transition-all add-to-cart" 
                                            data-id="${product.id}">
                                        <i class="fas fa-shopping-cart mr-2"></i>Agregar
                                    </button>
                                </div>
                            </div>
                        </div>
                    `);
                });

                // Actualizar contador de productos
                $('#productCount').text(`${filteredProducts.length} productos encontrados`);
            }

            // Función para mostrar detalles del producto
            function showProductDetails(productId) {
                const product = products.find(p => p.id === productId);
                if (!product) return;

                // Actualizar contenido del modal
                $('#productDetailTitle').text(product.name);
                $('#productDetailImage').attr('src', product.image);
                $('#productDetailCategory').text(product.category.toUpperCase());
                $('#productDetailPrice').text(`$${product.price}`);
                $('#productDetailDescription').text(product.description);

                // Generar especificaciones basadas en la categoría
                const specs = getProductSpecs(product);
                const specsHtml = specs.map(spec => `
                    <div class="flex justify-between">
                        <span class="text-gray-400">${spec.label}:</span>
                        <span class="text-white">${spec.value}</span>
                    </div>
                `).join('');
                $('#productDetailSpecs').html(specsHtml);

                // Configurar botón de agregar al carrito
                $('#productDetailAddToCart').data('product-id', product.id);

                // Mostrar modal
                $('#productDetailModal').removeClass('hidden');
            }

            // Función para generar especificaciones según la categoría
            function getProductSpecs(product) {
                const specs = [];
                switch (product.category) {
                    case 'cpu':
                        if (product.name.includes('Intel')) {
                            specs.push(
                                {label: 'Fabricante', value: 'Intel'},
                                {label: 'Socket', value: 'LGA 1700'},
                                {label: 'Tecnología', value: '10nm Intel 7'},
                                {label: 'TDP', value: '125W'}
                            );
                        } else {
                            specs.push(
                                {label: 'Fabricante', value: 'AMD'},
                                {label: 'Socket', value: 'AM5'},
                                {label: 'Tecnología', value: '5nm TSMC'},
                                {label: 'TDP', value: '170W'}
                            );
                        }
                        break;
                    case 'gpu':
                        if (product.name.includes('NVIDIA')) {
                            specs.push(
                                {label: 'Arquitectura', value: 'Ada Lovelace'},
                                {label: 'Ray Tracing', value: '3ra Generación'},
                                {label: 'DLSS', value: 'Versión 3.0'},
                                {label: 'Tecnología', value: '4nm TSMC'}
                            );
                        } else {
                            specs.push(
                                {label: 'Arquitectura', value: 'RDNA 3'},
                                {label: 'Ray Tracing', value: '2da Generación'},
                                {label: 'FSR', value: 'Versión 3.0'},
                                {label: 'Tecnología', value: '5nm TSMC'}
                            );
                        }
                        break;
                    // Agregar más casos según sea necesario
                }
                return specs;
            }

            // Evento para abrir detalles del producto
            $(document).on('click', '.product-card', function(e) {
                if (!$(e.target).closest('.add-to-cart').length) {
                    const productId = $(this).data('product-id');
                    showProductDetails(productId);
                }
            });

            // Evento para agregar al carrito desde la página principal
            $(document).on('click', '.add-to-cart', function(e) {
                e.stopPropagation(); // Evitar que se abra el modal de detalles
                const productId = $(this).data('id');
                const existingItem = cart.find(item => item.id === productId);
                
                if (existingItem) {
                    existingItem.quantity += 1;
                } else {
                    cart.push({ id: productId, quantity: 1 });
                }
                
                localStorage.setItem('cart', JSON.stringify(cart));
                updateCartDisplay();
                
                const product = products.find(p => p.id === productId);
                showNotification(`¡${product.name} agregado al carrito!`);
            });

            // Función para proceder al pago
            $('#checkoutButton').click(function() {
                if (cart.length === 0) {
                    showNotification('El carrito está vacío', 'error');
                    return;
                }

                const total = cart.reduce((sum, item) => {
                    const product = products.find(p => p.id === item.id);
                    return sum + (product.price * item.quantity);
                }, 0);

                // Mostrar resumen de la compra
                const orderSummary = `
                    Total de la compra: $${total.toFixed(2)}
                    Número de productos: ${cart.reduce((sum, item) => sum + item.quantity, 0)}
                    
                    ¿Desea confirmar su compra?
                `;

                if (confirm(orderSummary)) {
                    // Simular proceso de pago
                    showNotification('Procesando su pago...', 'info');
                    
                    setTimeout(() => {
                        // Limpiar carrito
                        cart = [];
                        localStorage.setItem('cart', JSON.stringify(cart));
                        updateCartDisplay();
                        
                        // Cerrar modal del carrito
                        $('#cartModal').addClass('hidden');
                        
                        // Mostrar confirmación
                        showNotification('¡Compra realizada con éxito!', 'success');
                    }, 2000);
                }
            });

            // Función mejorada para mostrar notificaciones
            function showNotification(message, type = 'success') {
                const bgColor = {
                    success: 'bg-green-600',
                    error: 'bg-red-600',
                    info: 'bg-blue-600'
                };

                const notification = $(`
                    <div class="fixed bottom-4 right-4 ${bgColor[type]} text-white px-6 py-3 rounded-lg shadow-lg transform transition-all duration-300 opacity-0 flex items-center">
                        <i class="fas ${type === 'success' ? 'fa-check' : type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle'} mr-2"></i>
                        ${message}
                    </div>
                `);
                
                $('body').append(notification);
                notification.animate({ opacity: 1, bottom: '20px' }, 300);
                
                setTimeout(() => {
                    notification.animate({ opacity: 0, bottom: '16px' }, 300, function() {
                        notification.remove();
                    });
                }, 3000);
            }

            // Función para cerrar todos los modales
            function closeAllModals() {
                $('#searchModal, #userModal, #cartModal, #paymentModal, #productDetailModal').addClass('hidden');
            }

            // Cerrar modal al hacer clic en el botón de cierre
            $('.modal-close').click(function() {
                $(this).closest('.fixed').addClass('hidden');
            });

            // Cerrar modal al hacer clic fuera del contenido
            $('.fixed').click(function(e) {
                if (e.target === this) {
                    $(this).addClass('hidden');
                }
            });

            // Cerrar modal con la tecla ESC
            $(document).keydown(function(e) {
                if (e.key === 'Escape') {
                    closeAllModals();
                }
            });

            // Modificar los eventos existentes para usar las nuevas funciones
            $('.fa-search').parent().click(function(e) {
                e.stopPropagation();
                closeAllModals();
                $('#searchModal').removeClass('hidden');
                $('#searchModalInput').focus();
            });

            $('#logoutBtn').click(function(e) {
                e.stopPropagation();
                closeAllModals();
                const user = JSON.parse(localStorage.getItem('user') || '{}');
                $('#userEmail').text(user.email || 'Usuario');
                $('#userModal').removeClass('hidden');
            });

            // Modificar el checkout para usar el nuevo sistema
            $('#checkoutButton').click(function() {
                if (cart.length === 0) {
                    showNotification('El carrito está vacío', 'error');
                    return;
                }

                const total = cart.reduce((sum, item) => {
                    const product = products.find(p => p.id === item.id);
                    return sum + (product.price * item.quantity);
                }, 0);

                $('#paymentAmount').text(`$${total.toFixed(2)}`);
                closeAllModals();
                $('#paymentModal').removeClass('hidden');
            });

            // Formateo de tarjeta de crédito
            $('#cardNumber').on('input', function() {
                let value = $(this).val().replace(/\D/g, '');
                value = value.replace(/(.{4})/g, '$1 ').trim();
                $(this).val(value);
            });

            // Formateo de fecha de expiración
            $('#expiryDate').on('input', function() {
                let value = $(this).val().replace(/\D/g, '');
                if (value.length > 2) {
                    value = value.substring(0, 2) + '/' + value.substring(2);
                }
                $(this).val(value);
            });

            // Validación del formulario de pago
            $('#paymentForm').submit(function(e) {
                e.preventDefault();
                
                const cardNumber = $('#cardNumber').val().replace(/\s/g, '');
                const expiryDate = $('#expiryDate').val();
                const cvv = $('#cvv').val();
                const cardName = $('#cardName').val();

                if (cardNumber.length < 16) {
                    showNotification('Número de tarjeta inválido', 'error');
                    return;
                }

                if (expiryDate.length < 5) {
                    showNotification('Fecha de expiración inválida', 'error');
                    return;
                }

                if (cvv.length < 3) {
                    showNotification('CVV inválido', 'error');
                    return;
                }

                if (cardName.length < 3) {
                    showNotification('Nombre inválido', 'error');
                    return;
                }

                // Simular procesamiento de pago
                showNotification('Procesando pago...', 'info');
                
                setTimeout(() => {
                    // Limpiar carrito
                    cart = [];
                    localStorage.setItem('cart', JSON.stringify(cart));
                    updateCartDisplay();
                    
                    // Cerrar modal de pago
                    $('#paymentModal').addClass('hidden');
                    
                    // Mostrar confirmación
                    showNotification('¡Pago realizado con éxito!', 'success');
                    
                    // Limpiar formulario
                    $('#paymentForm')[0].reset();
                }, 2000);
            });

            // Inicializar la página
            console.log('Inicializando página...'); // Para debugging
            renderProducts();
            updateCartDisplay();
        });
    </script>
</body>
</html> 